{% extends "financez/base.html" %}
{% load static %}

{% block extra_styles %}
    <link rel="stylesheet" type="text/css" href="{% static 'financez/index.css' %}">
{% endblock %}

{% block content %}

    <div class="row">
        <div class="results">
            <div class="results-block">
                <div class="results-header">Results</div>
                <label>Assets</label>
                <label>{{ assets_sum|floatformat:3 }}</label>
                <label>Savings</label>
                <label>{{ savings_sum|floatformat:3 }}</label>
                <label>Debts</label>
                <label>{{ debts_sum|floatformat:3 }}</label>
            </div>
            <div class="results-block">
                <div class="results-header">Planning</div>
                <label>Food</label>
                <label>{{ planning_food }}</label>
                <label>Transport</label>
                <label>{{ planning_transport }}</label>
                <label>Payments</label>
                <label>{{ planning_payments }}</label>
                <label>Unscheduled</label>
                <label>{{ planning_unscheduled }}</label>
            </div>
            <div class="results-block">
                <div class="results-header">Debts</div>
                {% for debt in debts_queryset %}
                    {% widthratio debt.total 1 -1 as total_debt %}
                    <label>{{ debt.acc.name }}</label>
                    <label>{{ total_debt|floatformat:3 }} </label>
                {% empty %}
                    <label>-</label>
                {% endfor %}
            </div>
            <div class="results-block">
                <div class="results-header">{{ current_month|date:"M Y" }}</div>
                <span>Incomes</span>
                <span>{{ incomes_sum|floatformat:3 }}</span>
                <span>Expenses</span>
                <span>{{ expenses_sum|floatformat:3 }} </span>
                <span>Result</span>
                <span>{{ month_result|floatformat:3 }} </span>
            </div>
        </div>
    </div>

    <hr>

    <div class="row">
        <form method="POST" class="new-entry-form">
            {% csrf_token %}
            {{ form.date }}
            {{ form.acc_dr }}
            {{ form.acc_cr }}
            {{ form.total }}
            {{ form.currency }}
            {{ form.comment }}
            <button>Add</button>
        </form>
    </div>

    <div class="row">
        <div class="main-book-header">
            <div>Date</div>
            <div>DR</div>
            <div>CR</div>
            <div style="text-align: right">Sum</div>
            <div style="text-align: center">Currency</div>
            <div>Comment</div>
        </div>
    </div>

    <div class="row">
        <div class="main-book">
            {% for entry in entries %}
                <div class="main-book-item">{{ entry.date|date:"Y M d"  }}</div>
                <div class="main-book-item">{{ entry.acc_dr }}</div>
                <div class="main-book-item">{{ entry.acc_cr }}</div>
                <div class="main-book-item" style="text-align: right">{{ entry.total|floatformat:3 }}</div>
                <div class="main-book-item" style="text-align: center">{{ entry.currency }}</div>
                <div class="main-book-item">{{ entry.comment }}</div>
            {% endfor %}
        </div>
    </div>

    <div id="account-selector" class="account-selector">
        <div class="row" style="height: 100%; align-items: center">
            <div class="accounts-list">
                <input hidden id="acc_type"></input>
                <div> {% include 'financez/account_list.html' with account_list=account_list title="Accounts" %} </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script src="{% static 'financez/main_book.js' %}"></script>
{% endblock %}